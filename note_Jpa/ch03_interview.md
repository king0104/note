A.   Entity Manager 의 역할은 무엇인가요?

- 엔티티를 등록, 수정, 조회, 삭제 작업을 진행할 수 있다. 그래서, 가상 데이터베이스라고 생각해도 무방하다.
- 엔티티를 영속성 컨텍스트에 저장하는 역할을 한다.



B.   영속성 컨텍스트를 설명해주세요.

- 데이터베이스에 저장하기 전, 엔티티를 저장해두는 공간이라고 생각하면 된다.

- 엔티티를 영속 상태로 만들어두는 공간

- 1차 캐시와 쓰기지연 sql 저장소로 이루어져있다.

- 특징으로는,

  - 1차 캐시
  
    - 1차 캐시를 이용해 인스턴스를 저장해두게 된다. 
    - 동일성, 변경 감지 등의 기반 특징이 된다.
  
  - 동일성 보장
  
    - 조회를 몇번이나 하더라도, 1차 캐시에 저장된 같은 객체를 반환해준다.
  
  - 쓰기 지연
  
    - insert 쿼리를 모아두었다가, 한번에 쿼리 날리기
  
    ---
  
    - 질문 : 쓰기 지연이면, insert, update 말고 em으로 조회하는 작업은 commit()이 되지 않아도(flush()가 되지 않아도) 동작하는 건가요???
      - 아 그럼 혹시 이건가요?? db에서 객체 가져와야 하면 commit 후에 동작하는거고 1차캐시에서 조회 가능하면, commit() 전에, 코드 진행하자마자 동작??
  
  
    ---
  
    
  
  - 변경 감지
  
    - 처음 1차 캐시에 인스턴스가 저장될 때, 스냅샷을 생성한다.
    - 커밋 전, 1차 캐시에 최종적으로 저장된 엔티티와 스냅샷을 비교한다
    - 변경된 부분에 대한 update 쿼리를 생성해 쓰기지연 sql 저장소에 쿼리를 저장한다.
  
  - 지연 로딩 
  
    - ?
  
  
  이 있다.





C.   Flush 기능이 어떤 역할을 수행하는 지와 왜 필요한지 설명해주세요.

- 영속성 컨텍스트의 내용과 데이터베이스의 내용을 동기화시켜주는 역할
- 구체적으로는 다음과 같은 2가지 과정을 수행한다
  1. 변경 감지 동작. 영속 엔티티 & 스냅샷 비교하여 수정 쿼리 생성
  2. 쓰기지연 sql 저장소의 쿼리를 데이터베이스에 전송
- 핵심적으로는 쓰기 지연이라는 작업을 수행하기 위해서이고, 조금 더 크게 말하자면 영속성 컨텍스트의 변경 내용을 데이터베이스에도 적용해야하기 때문이다.



D.   비영속 / 영속 / 준영속 / 삭제 상태가 무엇인지 설명해주세요.

엔티티의 상태를 말한다.

- 비영속
  - 영속성 컨텍스트와 전혀 관계가 없는 상태
- 영속
  - 영속성 컨텍스트에 저장된 상태
- 준영속
  - 영속성 컨텍스트에 저장되어 있다가, 분리된 상태(준영속)
- 삭제
  - 영속성 컨텍스트에서 분리됨과 동시에, 삭제 쿼리가 생성된다.
  - 영속성 컨텍스트에서도 분리(준영속) & 데이터베이스에서도 삭제 된 상태이다(delete 쿼리 생성).



E.   Merge() 메소드는 어떤 동작을 수행하는 지 설명해주세요.

- 준영속 상태 엔티티를 이용하여 -> 영속 상태의 새로운 엔티티를 만들어낸다.
- 주의할 점
  - 준영속 상태 엔티티는 계속 준영속 상태로 남아있다 & 영속 상태의 새로운 엔티티가 반환된다
    - 리턴 엔티티를 준영속 상태 엔티티와 동일하게 주면, 이 문제 해결

