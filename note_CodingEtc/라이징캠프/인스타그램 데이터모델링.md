## 인스타그램 데이터모델링

- ![image-20210706185022241](C:\Users\4545a\AppData\Roaming\Typora\typora-user-images\image-20210706185022241.png)
- Entity= table
- attribute = column = key

  - 관계 자체는 테이블과 테이블로 본다.
- 관계 설정은 각 테이블의 key를 연결짓는 것이다. 이 key를 통해 두개의 테이블을 하나로 엮어주는 것이다!!!! 이때, key는 똑같다.
- 도메인
  - 하나의 애트리뷰트가 취할 수 있는 같은 타입의 **원자(Atomic)값들의 집합**
  - 실제 애트리뷰트 값이 나타날 때 그 값의 합법 여부를 시스템이 검사하는 데 사용

- 기본키 / 외래키

  - 외래키

    - 다른 테이블의 기본키를 참조한다.
    - 외래키의 모든 필드는 참조하는 **기본키와 동일한 도메인(값의 종류&범위)**을 갖는다.
    - 외래키의 모든 필드의 값은 참조하는 기본키와 **동일하거나 null** 이다.

    출처: https://www.crocus.co.kr/1332 [Crocus]



1. 가장 먼저 엔티티를 선택할 수 있다.

2. 그 다음 그 엔티티(테이블)에 맞는 attribute 선택
   - 여기서 무조건 primary key를 넣는다 - 해당 테이블의 각 튜플을 구별짓는 attribute(=인덱스) 넣기 - xx의 id
   - 해당 테이블이 가지는 속성이 뭐가 있을까 생각해보기
     - 하나의 테이블에 대해 여러개의 속성 생각
     - 각 테이블 별로 관계가 맺어져 있다 => 부모-자식 엔티티 관계, 참조관계 등
	      - 이때는 테이블의 속성이 겹치는 부분이 발생할 수 있다.
	    - 부모 테이블의 primary key 가 자식 테이블의 forigen key 가 된다

3. 테이블끼리의 관계 생각

	- 1:1, 1:다, 다:1, 다:다



인스타그램 데이터모델링

1. 인스타그램 데이터베이스에 필요한 사항들 정리

- 회원이 인스타그램에 접속

- 

- 회원 정보 : 계정 아이디, 비밀번호, 사용자 아이디

- 콘텐츠 : 

  

**엔티티를 작성하면서 더 쪼갤 수 있는 속성이 남아있으면, 새로운 엔티티로 만들기!!!**

아니 하나의 엔티티에서 다른 엔티티로 넘어갈 수 있는 기능이 있는건 데이터베이스에 어떻게 구현하는거지...?
이건 구현을 안하나?? - 이때 외래키를 사용해서 다른

그냥 버튼 하나 있는 부분. 예를 들어 전화걸기라던지 사진찍기 이런 기능은 데이터베이스에 넣는게 아닌가?

데이터베이스 모델링 할 때는 정보가 저장되어있는 부분만 넣는건가?



일단 작성자는 다 userid로 한다. 각 테이블+id는 primary key로써, 각 게시물의 유일한 값을 나타내는 인덱스이다.

속성에 굵게 표시한 것 => 테이블.

즉, 굵게 표시된 테이블들은, 해당 테이블의 부모 테이블이 되는 것이다.

궁금한점. 테이블의 속성에 테이블이 들어갈 수 있나?

일단은 아닌 것 같다. 부모 테이블의 속성을 가져오는 것까지는 가능하다. 그리고 이것이 

- 엔티티 / 어트리뷰트

  - 다이렉트 메세지 : **본인 계정 이름**, **상대방 계정**, **채팅방**, 새로운 메세지 존재 여부, 마지막으로 대화한 시간
  - 디엠 채팅방 : **상대방 계정 스토리**, **상대방 계정 이름**, 읽음 확인 표시

  

  - 스토리 : **스토리 작성자**, 올린 시간(지난 시간), 이미지
  - 게시글 : **게시글 작성자**, 이미지, 좋아요 갯수, 본문, **댓글**, 작성 시간
  - 작성자(유저) : 유저 이름, 유저 프로필 사진, **스토리**, 포스트 갯수, 팔로워 수, 팔로잉 수, 소개글,  **하이라이트**, **게시글**, **릴스**, **태그된 게시글**
    - 본인 계정 : - 작성자(유저)의 속성을 따른다
  - 댓글 :  **댓글 작성자**, 작성 시간, 내용, 좋아요 갯수
  - 하이라이트 : 하이라이트 제목, 하이라이트 이미지, 이미지, 올린 날짜(지난 날짜)
  - 릴스 : 릴스 작성자, 동영상, 본문, 노래 제목, 좋아요 갯수, 댓글 갯수
  - 검색창 : 전체 검색창, **게시글**, **릴스**  - 이거 테이블로 못만들지 않나..? 튜플 생성이 불가능한데?



FK 설정시 화살표 헤드가 있는 쪽이 부모 없는 쪽이 자식입니다.

자식이 부모를 참조하는 것이죠.

예를 회원의 PK를 포함한 상세 정보는 [회원]테이블에 있고 

회원이 작성한 글은 [작성글] 테이블에 들어가게 되는데 

[회원.회원ID] <- [작성글.회원ID] 이런식으로 참조하게 됩니다.



- 관계 추출하기 <단방향으로 생각>

  - 다이렉트 메세지는 디엠 채팅방을 가진다. 1:N

  - 디엠 채팅방은 스토리를 가진다. 1:1
  - 디엠 채팅방은 유저를 가진다. 1:1

  - 스토리는 유저를 가진다. 1:1

  - 게시글은 유저를 가진다. 1:1
  - **게시글은 댓글을 가진다. 1:N**
  - **유저는 하이라이트를 가진다 1:N**
  - **유저는 게시글을 가진다 1:N**
  - **유저는 릴스를 가진다 1:N**
  - **유저는 태그된 게시글을 가진다 1:N**
  - 댓글은 유저를 가진다 1:1
  - 릴스는 유저를 가진다 1:1
  - **검색창은 게시글을 가진다 1:N**
  - **쇼핑은 쇼핑 카테고리를 가진다 1:N**
  - **쇼핑은 게시글을 가진다 1:N**



- 피드백
- 첫 째, 단어 사이 _를 쓸지(Wish_lists), 대문자를 작성할지(WishLists). 둘 째, 단어 시작을 대문자로 할지, 소문자로 할지. 테이블 단어 이름은 대문자로 칼럼 이름은 소문자로 시작하는 것을 선호합니다.





- 질문
- messages에 대화 내용을 저장한다고 생각했을때 저렇게 만들어두면 되는 것이 맞나요? 느낌상 많은 대화를 저장하려면 단지 저렇게 하나의 컬럼으로는 안될 것 같은데 다른 방법도 생각이 잘 안납니다...ㅜㅠ
- lastTalkedTime의 타입과 디폴트 값을 어떻게 주어야 하는지 모르겠습니다. 어떻게 해야 마지막으로 대화한 시간을 표시하는 것으로 나타낼 수 있을까요?



- 연결관계
- 스토리에서 뜨는 유저 아이디를 클릭했을 때 해당 유저의 메인 화면으로 넘어가는데, 이건 어떻게 설정해야하는지 모르겠습니다. 
- 유저 메인 화면에서 스토리로 넘어가는 방식을 생각하여, 유저 테이블에서 스토리 테이블로 부모-자식 관계(참조관계)를 설정해두었는데, 양방향으로는 관계를 설정하지 못한다고 하여 앞서 말한 기능(스토리에서 유저 메인 화면으로 넘어가기)의 관계를 구현하지 못했는데, 이런 구조는 어떻게 짜야할 지 모르겠습니다.

